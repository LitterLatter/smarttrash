<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SmartTrash ‚Äì Report a Problem</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #f4f6f9;
}

header {
  background: #00695c;
  color: white;
  padding: 20px;
}

.container {
  padding: 25px;
}

.card {
  background: white;
  padding: 25px;
  border-radius: 12px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  max-width: 600px;
  margin: auto;
}

label {
  font-weight: bold;
  display: block;
  margin-top: 10px;
}

input, select, textarea {
  width: 100%;
  padding: 10px;
  margin-top: 6px;
  margin-bottom: 10px;
  border-radius: 6px;
  border: 1px solid #ccc;
}

textarea {
  resize: vertical;
}

button {
  background: #00695c;
  color: white;
  border: none;
  padding: 12px 20px;
  border-radius: 20px;
  cursor: pointer;
  opacity: 0.6;
}

button.active {
  opacity: 1;
}

button:disabled {
  cursor: not-allowed;
}

#preview {
  display: none;
  width: 100%;
  margin-top: 10px;
  border-radius: 10px;
  border: 1px solid #ddd;
}

.success {
  display: none;
  margin-top: 15px;
  color: green;
  font-weight: bold;
}

.checklist {
  margin-top: 15px;
  font-size: 13px;
  color: #555;
}

.check-item {
  display: flex;
  align-items: center;
  margin-bottom: 6px;
}

.box {
  width: 14px;
  height: 14px;
  border: 2px solid #999;
  border-radius: 3px;
  margin-right: 8px;
}

.box.checked {
  background: #00695c;
  border-color: #00695c;
}
</style>
</head>

<body>

<header>
  <h2>üìù Report a Problem</h2>
</header>

<div class="container">
  <div class="card">

    <label>Issue Type</label>
    <select id="issueType">
      <option>Sampah Bersepah</option>
      <option>Tong Rosak</option>
      <option>Tong Hilang</option>
      <option>Bau Busuk</option>
      <option>Lain-lain</option>
    </select>

    <label>Location</label>
    <input type="text" id="location">

    <label>Description</label>
    <textarea id="description" rows="4"></textarea>

    <label>Upload Photo</label>
    <input type="file" id="photo" accept="image/*">

    <img id="preview">

    <div class="checklist">
      <div class="check-item">
        <div id="checkLocation" class="box"></div>
        <span>Sila isi lokasi</span>
      </div>
      <div class="check-item">
        <div id="checkDesc" class="box"></div>
        <span>Sila isi masalah</span>
      </div>
      <div class="check-item">
        <div id="checkPhoto" class="box"></div>
        <span>Sila upload gambar bukti</span>
      </div>
    </div>

    <br>

    <button id="submitBtn" onclick="submitComplaint()" disabled>
      Submit Report
    </button>

    <p class="success" id="successMsg">
      ‚úÖ Report berjaya dihantar!
    </p>

  </div>
</div>

<script>

const scriptURL = "https://script.google.com/macros/s/AKfycbzR6-5VjyjlmZd5jZA9fBoVprj3ynN437GkRG7lziRxMXUMw-aW29XUJV5mp_hb2Xl3/exec";

const locationInput = document.getElementById("location");
const descInput = document.getElementById("description");
const photoInput = document.getElementById("photo");
const submitBtn = document.getElementById("submitBtn");

function toggleCheck(id, condition) {
  const box = document.getElementById(id);
  condition ? box.classList.add("checked") : box.classList.remove("checked");
}

function validateForm() {

  let validLocation = locationInput.value.trim() !== "";
  let validDesc = descInput.value.trim() !== "";
  let validPhoto = photoInput.files.length > 0;

  toggleCheck("checkLocation", validLocation);
  toggleCheck("checkDesc", validDesc);
  toggleCheck("checkPhoto", validPhoto);

  if (validLocation && validDesc && validPhoto) {
    submitBtn.disabled = false;
    submitBtn.classList.add("active");
  } else {
    submitBtn.disabled = true;
    submitBtn.classList.remove("active");
  }
}

locationInput.addEventListener("input", validateForm);
descInput.addEventListener("input", validateForm);

photoInput.addEventListener("change", function () {

  validateForm();

  const file = this.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = function (e) {
    const img = document.getElementById("preview");
    img.src = e.target.result;
    img.style.display = "block";
  };
  reader.readAsDataURL(file);
});

function submitComplaint() {

  if (submitBtn.disabled) return;

  const file = photoInput.files[0];
  if (!file) return;

  const reader = new FileReader();

  reader.onload = function (e) {

    const formData = new FormData();
    formData.append("issueType", document.getElementById("issueType").value);
    formData.append("location", locationInput.value);
    formData.append("description", descInput.value);
    formData.append("photo", e.target.result);

    fetch(scriptURL, {
      method: "POST",
      body: formData
    })
    .then(res => res.json())
    .then(data => {

      if (data.status === "success") {
        document.getElementById("successMsg").style.display = "block";
        setTimeout(() => location.reload(), 2000);
      } else {
        alert("Error: " + data.message);
      }

    })
    .catch(err => {
      alert("Error menghantar report ‚ùå");
      console.log(err);
    });
  };

  reader.readAsDataURL(file);
}

</script>

</body>
</html>
